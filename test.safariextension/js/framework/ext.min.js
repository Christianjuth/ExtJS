(function(){var a,b;a={silent:!1},b={browser:"",version:"0.1.0",_onload:function(){return b._.options=a,$.each(b,function(a){var c,d,e,f;if(a=b[a],null!=a._&&null!=a._.aliases)for(f=a._.aliases,d=0,e=f.length;e>d;d++)c=f[d],b[c]=a;return null!=a._&&null!=a._.onload?a._.onload():void 0}),null==localStorage.options&&"chrome"===b._.browser&&(localStorage.options=JSON.stringify({})),b._.log={},b._.options.silent!==!0?(b._.log.info=function(){return Function.prototype.bind.call(console.info,console)}(),b._.log.warn=function(){return Function.prototype.bind.call(console.warn,console)}()):(b._.log.info=function(){},b._.log.warn=function(){}),b._.log.error=function(){return Function.prototype.bind.call(console.error,console)}()},chrome:function(a){var c,d;if(d="callback function",c=b._.validateArg(arguments,["function"],d),null!=c)throw new Error(c);return"chrome"===b._.browser?a():void 0},ini:function(c){return c=$.extend(a,c),b._config=c,b._.options=c,b._onload(),window.ext},_:{_load:function(){},browser:function(){var a,b,c;return b=navigator.userAgent,c=navigator.vendor,/Chrome/.test(b)&&/Google Inc/.test(c)?a="chrome":/Safari/.test(b)&&/Apple Computer/.test(c)?a="safari":/OPR/.test(b)&&/Opera Software/.test(c)&&(a="chrome"),a}(),validateArg:function(a,b,c){var d,e,f,g,h,i,j,k,l;for(c="does not match usage function("+c+")",e=i=0,k=b.length;k>i;e=++i)if(d=b[e],d=a[e],null!=b[e]){for(g=b[e].split(","),h=!1,j=0,l=g.length;l>j;j++)if(f=g[j],typeof d===f){h=!0;break}if(!h)return c}return void 0},getConfig:function(a){var c,d,e,f;if(f="callback function",e=b._.validateArg(arguments,["function,undefined"],f),null!=e)throw new Error(e);return c=null!=a?!0:!1,d="",$.ajax({url:"../../configure.json",dataType:"json",async:c,success:function(b){return d=b,null!=a?a(d):void 0}}),d},getDefaultIcon:function(){var a,c;if(a=b._.getConfig(),c={},null==a.menuIcon||null==a.menuIcon[16]&&null==a.menuIcon[19])throw Error("no default icons set in configure.json");return null==a.menuIcon[19]&&null!=a.menuIcon[16]?a.menuIcon[19]=a.menuIcon[16]:null==a.menuIcon[16]&&null!=a.menuIcon[19]&&(a.menuIcon[16]=a.menuIcon[19]),c[19]=a.menuIcon[19],c[16]=a.menuIcon[16],c},load:function(a,c){var d,e,f,g,h,i,j,k;if(h="id string, plugin object",g=b._.validateArg(arguments,["string","object"],h),null!=g)throw new Error(g);if(f=c._.name,b[a]=c,null!=c._.aliases)for(k=c._.aliases,i=0,j=k.length;j>i;i++)d=k[i],null==b[d]?(b[d]=b[a],delete c._.aliases):(e='Ext plugin "'+f+'" can\'t define alias "'+d+'"',b._.log.warn(e));return null!=c._.onload?(c._.onload(b._.options),delete c._.onload):void 0},log:{info:function(){},warn:function(){},error:function(){}}},match:{url:function(c,d,e){var f,g,h,i,j,k;if(k="url string, urlSearchSyntax, options object",h=b._.validateArg(arguments,["string","string","object,undefined"],k),null!=h)throw new Error(h);return a={maxLength:"*",minLength:0,ignorecase:!0,require:""},j=d,i=!1,e=$.extend(a,e),c=c.replace(/\%20/i," "),g=/^\!/.test(j),f="{ , } /?",j=j.replace(/^\!/g,""),j=b.parse.normalize(j),j=j.replace(/\$\$/g,"(\\$)"),j=j.replace(/(\$)?\?/g,function(a,b){return b?a:"[^/]"}),j=j.replace(/(\*|\$)?\*/g,function(a,b){return b?a:"([^/]+)*"}),j=j.replace(/\*\*/g,".*?"),j=j.replace(/\$\*/g,"\\*"),j=j.replace(/(\$)?{/g,function(a,b){return b?a:"("}),j=j.replace(/(\$)?}/g,function(a,b){return b?a:")"}),j=j.replace(/(\$)?,/g,function(a,b){return b?a:"|"}),f=f.replace(/\ /g,"|"),f=new RegExp("\\$(?=("+f+"))","g"),j=j.replace(f,""),j=e.ignorecase?new RegExp("^("+j+")$","gi"):new RegExp("^("+j+")$","g"),i=g?!j.test(c):j.test(c),"*"!==e.maxLength&&(i=i&&c.length<=e.maxLength),i=i&&c.length>=e.minLength,i=i&&c.contains(e.require)},text:function(c,d,e){var f,g,h,i,j,k;if(k="url string, textSearchSyntax, options object",h=b._.validateArg(arguments,["string","string","object,undefined"],k),null!=h)throw new Error(h);return a={allowSpaces:!0,maxLength:"*",minLength:0,require:"",ignorecase:!0},j=d,i=!1,e=$.extend(a,e),g=/^\!/.test(j),f="{ , } /?",j=j.replace(/^\!/g,""),j=b.parse.normalize(j),j=j.replace(/\$\$/g,"(\\$)"),j=j.replace(/(\$)?\?/g,function(a,b){return b?a:"."}),j=j.replace(/(\$)?\*/g,function(a,b){return b?a:".*?"}),j=j.replace(/\$\*/g,"\\*"),j=j.replace(/(\$)?{/g,function(a,b){return b?a:"("}),j=j.replace(/(\$)?}/g,function(a,b){return b?a:")"}),j=j.replace(/(\$)?,/g,function(a,b){return b?a:"|"}),f=f.replace(/\ /g,"|"),f=new RegExp("\\$(?=("+f+"))","g"),j=j.replace(f,""),j=e.ignorecase?new RegExp("^("+j+")$","gi"):new RegExp("^("+j+")$","g"),i=g?!j.test(c):j.test(c),e.allowSpaces||(i=i&&-1===c.indexOf(" ")),"*"!==e.maxLength&&(i=i&&c.length<=e.maxLength),i=i&&c.length>=e.minLength,i=i&&c.contains(e.require)}},menu:{setIcon:function(a){var c,d,e,f;if(f="url string",e=b._.validateArg(arguments,["string"],f),null!=e)throw new Error(e);return"chrome"===b._.browser?(c={path:chrome.extension.getURL("menu-icons/"+a+"-16.png")},chrome.browserAction.setIcon(c)):"safari"===b._.browser&&(d=safari.extension.baseURI+"menu-icons/"+a+"-19.png",safari.extension.toolbarItems[0].image=d),c},resetIcon:function(){var a,c,d;return d=b._.getDefaultIcon(),"chrome"===b._.browser?(a={path:chrome.extension.getURL(d[19])},chrome.browserAction.setIcon(a)):"safari"===b._.browser&&(c=safari.extension.baseURI+d[16],safari.extension.toolbarItems[0].image=c),a},iconOnClick:function(a){var c,d;if(d="callback function",c=b._.validateArg(arguments,["function"],d),null!=c)throw new Error(c);if(null==b._.getConfig().popup)throw Error("can not define menu icon callback if popup is set in config");return"chrome"===b._.browser?chrome.browserAction.onClicked.addListener(function(){return a()}):"safari"===b._.browser?safari.application.addEventListener("command",function(b){return"icon-clicked"===b.command?a():void 0},!1):void 0},setBadge:function(a){var c,d;if(d="number",c=b._.validateArg(arguments,["number"],d),null!=c)throw new Error(c);return a=parseInt(a),"chrome"===b._.browser?(0===a&&(a=""),chrome.browserAction.setBadgeText({text:String(a)}),chrome.browserAction.setBadgeBackgroundColor({color:"#8E8E91"})):"safari"===b._.browser&&(safari.extension.toolbarItems[0].badge=a),""===a&&(a=0),a},getBadge:function(a){var c,d,e;if(e="callback function",c=b._.validateArg(arguments,["function"],e),null!=c)throw new Error(c);return"chrome"===b._.browser&&(d=chrome.browserAction.getBadgeText({},a)),"safari"===b._.browser&&(d=safari.extension.toolbarItems[0].badge),d}},options:{_:{aliases:["ops","opts"],changeBindings:[],bindChange:function(a){return b.options._changeBindings.push(a),console.log(b.options._changeBindings),console.log(a)},callChangeBindings:function(){var a,c,d,e,f;for(console.log(b.options._changeBindings),e=b.options._changeBindings,f=[],c=0,d=e.length;d>c;c++)a=e[c],f.push(a());return f},load:function(){var a,c,d,e,f,g;if(alert(),"chrome"===b._.browser){for(a=b._.getConfig(),f=a.options,g=[],d=0,e=f.length;e>d;d++)c=f[d],g.push("undefined"==typeof b.options.get(c.key)?b.options.set(c.key,c["default"]):void 0);return g}}},set:function(a,c){var d,e,f;if(f="key string, value",d=b._.validateArg(arguments,["string","string,number,object"],f),null!=d)throw new Error(d);return"chrome"===b._.browser?(e=$.parseJSON(localStorage.options),e[a]=c,localStorage.options=JSON.stringify(e),b.options._.callChangeBindings()):"safari"===b._.browser&&(safari.extension.settings[a]=c),e[a]},get:function(a){var c,d,e,f;if(f="key string",c=b._.validateArg(arguments,["string"],f),null!=c)throw new Error(c);return"chrome"===b._.browser?(d=$.parseJSON(localStorage.options),e=d[a]):"safari"===b._.browser&&(e=safari.extension.settings[a]),e},reset:function(a){var c,d,e,f;if(f="key string",c=b._.validateArg(arguments,["string"],f),null!=c)throw new Error(c);return"chrome"===b._.browser?(e=$.parseJSON(localStorage.options),$.ajax({url:"../../configure.json",dataType:"json",async:!1,success:function(b){return e[a]=_.filter(b.options,{key:a})[0]["default"],localStorage.options=JSON.stringify(e)}}),d=e[a]):"safari"===b._.browser&&(d=safari.extension.settings.removeItem(a)),d},resetAll:function(a){return $.ajax({url:"../../configure.json",dataType:"json",async:!1,success:function(c){var d,e,f,g,h;for(g=c.options,h=[],e=0,f=g.length;f>e;e++)d=g[e],h.push(-1===a.indexOf(d.key)?b.options.reset(d.key):void 0);return h}}),b.options.dump()},dump:function(){var a;return a=[],$.ajax({url:"../../configure.json",dataType:"json",async:!1,success:function(b){var c,d,e,f,g;for(f=b.options,g=[],d=0,e=f.length;e>d;d++)c=f[d],g.push(a.push(c.key));return g}}),a},onChange:function(a){var c,d,e;if(e="callback function",d=b._.validateArg(arguments,["function"],e),null!=d)throw new Error(d);return"chrome"===b._.browser&&(c=chrome.extension.getBackgroundPage().window,c.$(window).bind("storage",function(b){return"options"===b.originalEvent.key?a():void 0}),c.ext.options._.bindChange(a)),"safari"===b._.browser?safari.extension.settings.addEventListener("change",a,!1):void 0}},parse:{url:function(a){var c,d,e;if(e="url string",c=b._.validateArg(arguments,["string"],e),null!=c)throw new Error(c);if(!b.validate.url(a))throw Error("Invalid url");return d=-1!==a.indexOf("https://")&&-1!==a.indexOf("https://"),d||(a="http://"+a),a},array:function(){var a,b,c,d,e;for(c=[],a=arguments,d=0,e=a.length;e>d;d++)b=a[d],"string"==typeof b?c.push(b):c=c.concat(b);return c},id:function(a){var c,d;if(d="id string",c=b._.validateArg(arguments,["string"],d),null!=c)throw new Error(c);return a.toLowerCase().replace(/\ /g,"_")},normalize:function(a){var c,d,e;if(e="string",c=b._.validateArg(arguments,["string"],e),null!=c)throw new Error(c);return d="\\( \\) \\| \\. \\/ \\^ \\+ \\[ \\] \\- \\!",d=d.replace(/\ /g,"|"),d=new RegExp("(?=("+d+"))","g"),a=a.replace(d,"\\")}},safari:function(a){var c,d;if(d="callback function",c=b._.validateArg(arguments,["function"],d),null!=c)throw new Error(c);return"safari"===b._.browser?a():void 0},validate:{url:function(a){var c,d;if(d="url string",c=b._.validateArg(arguments,["string"],d),null!=c)throw new Error(c);return b.match.url(a,"*{://,www.,://www.,}*.**")},secureUrl:function(a){var c,d;if(d="url string",c=b._.validateArg(arguments,["string"],d),null!=c)throw new Error(c);return b.match.url(a,"https://{www.,}*.**")},file:function(a,c){var d,e;if(e="path string, type string",d=b._.validateArg(arguments,["string","string"],e),null!=d)throw new Error(d);return null!=c?b.match.url(a,"file://**."+c):b.match.url(a,"file://**")},email:function(a){var c,d;if(d="email string",c=b._.validateArg(arguments,["string"],d),null!=c)throw new Error(c);return b.match.text(a,"*@*.*",{allowSpaces:!1})},password:function(c,d){var e,f,g;if(g="passwd string, options object",f=b._.validateArg(arguments,["string","object,undefined"],g),null!=f)throw new Error(f);return a={maxLength:12,minLength:5,require:""},e={allowSpaces:!1,ignorecase:!1},d=$.extend(a,d),$.extend(d,e),b.match.text(c,"*",d)}}},Array.prototype.compress=function(){var a,b;return a=this,b=[],$.each(a,function(a,c){return-1===$.inArray(c,b)?b.push(c):void 0}),b},String.prototype.compress=function(){return this.replace(/\ /g,"")},String.prototype.contains=function(a){var c,d,e,f,g,h,i;for("object"==typeof a?g=a:(g=[],g.push(a)),e=!1,h=0,i=g.length;i>h;h++)f=g[h],d=/^\!/.test(f),c="{ , } /?",f=f.replace(/^\!/g,""),f=b.parse.normalize(f),f=f.replace(/\$\$/g,"(\\$)"),f=f.replace(/(\$)?\?/g,function(a,b){return b?a:"."}),f=f.replace(/(\$)?\*/g,function(a,b){return b?a:".*?"}),f=f.replace(/\$\*/g,"\\*"),f=f.replace(/(\$)?{/g,function(a,b){return b?a:"("}),f=f.replace(/(\$)?}/g,function(a,b){return b?a:")"}),f=f.replace(/(\$)?,/g,function(a,b){return b?a:"|"}),c=c.replace(/\ /g,"|"),c=new RegExp("\\$(?=("+c+"))","g"),f=f.replace(c,"\\"),f=new RegExp("^(.*?"+f+".*?)$","gi"),e=d?!f.test(this):f.test(this);return e},window.ext=b,"function"==typeof window.define&&window.define.amd&&window.define("ext",["jquery"],function(){return b._onload(),window.ext})}).call(this);