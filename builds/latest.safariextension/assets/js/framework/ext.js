(function(){var a,b;a={silent:!1},b={browser:"",ini:function(c){var d;return d=$.extend(a,c),this.browser=this.getBrowser(),null==localStorage.options&&"chrome"===this.browser&&(localStorage.options=JSON.stringify({})),$.each(b,function(a){var b,c,e,f,g,h;if(null!=window.ext[a]._info){if(a=window.ext[a],e=a._info.name,c=a._info.compatibility,null!=a._load&&(a._load(),delete a._load),null!=a._aliases){for(h=a._aliases,f=0,g=h.length;g>f;f++)b=h[f],null==window.ext[b]?window.ext[b]=window.ext[a]:d.silent!==!0&&console.warn('Ext plugin "'+e+'" can not define alias "'+b+'" becuase it is taken');delete a._aliases}return null!=a._info&&d.silent!==!0&&("none"===c.chrome?console.warn('Ext plugin "'+e+'" is Safari only'):"full"!==c.chrome&&console.warn('Ext plugin "'+e+'" may contain some Safari only functions'),"none"===c.safari?console.warn('Ext plugin "'+e+'" is Chrome only'):"full"!==c.safari&&console.warn('Ext plugin "'+e+'" may contain some Chrome only functions')),delete a._info}}),window.ext},getBrowser:function(){var a,b,c;return b=navigator.userAgent,c=navigator.vendor,/Chrome/.test(b)&&/Google Inc/.test(c)&&(a="chrome"),/OPR/.test(b)&&/Opera Software/.test(c)?a="chrome":/Safari/.test(b)&&/Apple Computer/.test(c)&&(a="safari"),a},options:{_aliases:["ops","opts"],set:function(a,c){var d;return"chrome"===b.browser?(d=$.parseJSON(localStorage.options),d[a]=c,localStorage.options=JSON.stringify(d)):"safari"===b.browser&&(safari.extension.settings[a]=c),d[a]},get:function(a){var c,d;return"chrome"===b.browser?(c=$.parseJSON(localStorage.options),d=c[a]):"safari"===b.browser&&(d=safari.extension.settings[a]),d},reset:function(a){var c,d;return"chrome"===b.browser?(d=$.parseJSON(localStorage.options),$.ajax({url:"../../configure.json",dataType:"json",async:!1,success:function(b){return d[a]=_.filter(b.options,{key:a})[0]["default"],localStorage.options=JSON.stringify(d)}}),c=d[a]):"safari"===b.browser&&(c=safari.extension.settings.removeItem(a)),c},resetAll:function(){return $.ajax({url:"../../configure.json",dataType:"json",async:!1,success:function(a){var c,d,e,f,g;for(f=a.options,g=[],d=0,e=f.length;e>d;d++)c=f[d],g.push(b.options.reset(c.key));return g}}),localStorage.options}},menu:{icon:{setIcon:function(a){var c,d;return"chrome"===b.browser?(c={path:chrome.extension.getURL("assets/icons/"+a)},chrome.browserAction.setIcon(c)):"safari"===b.browser?(d=safari.extension.baseURI+"icons/"+a,safari.extension.toolbarItems[0].image=d):void 0},click:function(a){return"chrome"===b.browser?chrome.browserAction.onClicked.addListener(function(){return a()}):"safari"===b.browser?safari.application.addEventListener("command",function(b){return"icon-clicked"===b.command?a():void 0},!1):void 0},setBadge:function(a){return a=parseInt(a),"chrome"===b.browser?(0===a&&(a=""),chrome.browserAction.setBadgeText({text:String(a)}),chrome.browserAction.setBadgeBackgroundColor({color:"#8E8E91"})):"safari"===b.browser&&(safari.extension.toolbarItems[0].badge=a),""===a&&(a=0),a},getBadge:function(a){return"chrome"===b.browser?chrome.browserAction.getBadgeText({},a):void 0}}},parse:{url:function(a,b){return b=b.replace("*",".+"),b=new RegExp("^"+b+"$","g"),b.test(a.replace(/\ /g,""))},id:function(a){return a.toLowerCase().replace(/\ /g,"_")}}},window.ext=b,window.extJS=b,"function"==typeof window.define&&window.define.amd&&window.define("ext",["jquery"],function(){return window.ext})}).call(this);